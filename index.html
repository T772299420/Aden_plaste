<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>شركة عدن الوطنية للصناعات المنزلية</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #FFFFF0;
      margin: 0;
      color: #8B0000;
      padding-top: 100px;
    }
    #tabBar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: #E41B17;
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 10000;
    }
    #tabBar button {
      background: none;
      border: none;
      color: #FFFFF0;
      font-weight: bold;
      font-size: 18px;
      cursor: pointer;
      padding: 10px 15px;
      border-bottom: 3px solid transparent;
      transition: border-bottom-color 0.3s ease;
    }
    #tabBar button.active {
      border-bottom-color: #8B0000;
    }
    .tabContent {
      display: none;
      max-width: 1000px;
      margin: auto;
      padding: 20px;
    }
    .tabContent.active {
      display: block;
    }
    footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      font-size: 14px;
      color: #8B0000;
      border-top: 2px solid #E41B17;
    }
    #lastUpdated {
      text-align: center;
      font-size: 13px;
      color: #555;
      margin-top: -30px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div id="tabBar">
    <button class="tabBtn active" data-tab="home">الرئيسية</button>
    <button class="tabBtn" data-tab="sales">مبيعات</button>
    <button class="tabBtn" data-tab="returns">مرتجعات</button>
    <button class="tabBtn" data-tab="contact">راسلنا</button>
    <button class="tabBtn" data-tab="admin">الإدارة</button>
  </div>  <div id="home" class="tabContent active">
    <h2 style="text-align:center;">شركة عدن الوطنية للصناعات المنزلية</h2>
  </div>  <div id="sales" class="tabContent">
    <div id="items"></div>
  </div>  <div id="returns" class="tabContent">
    <h3 style="text-align:center;">قسم المرتجعات</h3>
    <p style="text-align:center;">هذه الخاصية تحت التطوير.</p>
  </div>  <div id="contact" class="tabContent">
    <h3 style="text-align:center;">تواصل معنا</h3>
    <p style="text-align:center;">
      الهاتف: 00967772299420<br>
      البريد الإلكتروني: info@adenplastic.com<br>
      العنوان: صنعاء - اليمن
    </p>
  </div>  <div id="admin" class="tabContent">
    <div id="adminLogin">
      <h3 style="text-align:center;">تسجيل دخول الإدارة</h3>
      <input type="password" id="adminPassword" placeholder="كلمة المرور" style="display:block;margin:10px auto; padding:10px;width:300px;" />
      <button onclick="checkAdminPassword()" style="display:block; margin:auto;">دخول</button>
    </div>
    <div id="adminPanel" style="display:none;">
      <h3 style="text-align:center;">إدارة الأصناف</h3>
      <table id="adminTable" border="1" style="margin:auto; width:90%; text-align:center;">
        <thead>
          <tr><th>الاسم</th><th>الصورة</th><th>حذف</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <button onclick="addNewRow()" style="display:block;margin:10px auto;">إضافة صف جديد</button>
      <button onclick="saveAdminData()" style="display:block;margin:10px auto;">حفظ التغييرات</button>
    </div>
  </div>  <div id="lastUpdated"></div>  <footer>
    إعداد وبرمجة: مروان محمد عبد الله الذماري - 00967772299420
  </footer>  <script>
    const tabs = document.querySelectorAll('.tabBtn');
    const contents = document.querySelectorAll('.tabContent');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        contents.forEach(c => c.classList.toggle('active', c.id === tab.dataset.tab));
      });
    });

    let itemsData = [];
    let githubToken = "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";
    const repoUser = "T772299420";
    const repoName = "Aden_plaste";
    const filePath = "Data.csv";
    const branch = "main";

    fetchCSV();

    function fetchCSV() {
      fetch(`https://raw.githubusercontent.com/${repoUser}/${repoName}/${branch}/${filePath}`)
        .then(res => res.text())
        .then(text => {
          const wb = XLSX.read(text, { type: "string" });
          const sheet = wb.Sheets[wb.SheetNames[0]];
          itemsData = XLSX.utils.sheet_to_json(sheet);
          displayItems();
        });
    }

    function displayItems() {
      const container = document.getElementById("items");
      if (!container) return;
      container.innerHTML = "";
      itemsData.forEach(item => {
        const div = document.createElement("div");
        div.innerHTML = `<strong>${item.name}</strong> - <em>${item.image}</em>`;
        container.appendChild(div);
      });
    }

    function checkAdminPassword() {
      let pass = document.getElementById("adminPassword").value.trim();
      pass = pass.replace(/[٠-٩]/g, d => "٠١٢٣٤٥٦٧٨٩".indexOf(d));
      if (pass === "201020") {
        document.getElementById("adminLogin").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
        loadAdminTable();
      } else {
        alert("كلمة المرور غير صحيحة!");
      }
    }

    function loadAdminTable() {
      const tbody = document.querySelector("#adminTable tbody");
      tbody.innerHTML = "";
      itemsData.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `<td contenteditable="true">${item.name}</td>
                         <td contenteditable="true">${item.image}</td>
                         <td><button onclick="deleteRow(this)">🗑️</button></td>`;
        tbody.appendChild(row);
      });
    }

    function addNewRow() {
      const tbody = document.querySelector("#adminTable tbody");
      const row = document.createElement("tr");
      row.innerHTML = `<td contenteditable="true"></td>
                       <td contenteditable="true"></td>
                       <td><button onclick="deleteRow(this)">🗑️</button></td>`;
      tbody.appendChild(row);
    }

    function deleteRow(btn) {
      btn.closest("tr").remove();
    }

    async function saveAdminData() {
      const rows = document.querySelectorAll("#adminTable tbody tr");
      const newData = [];
      rows.forEach(row => {
        const name = row.cells[0].innerText.trim();
        const image = row.cells[1].innerText.trim();
        if (name && image) newData.push({ name, image });
      });
      itemsData = newData;
      displayItems();

      const csv = 'name,image\n' + newData.map(r => `${r.name},${r.image}`).join('\n');
      const contentBase64 = btoa(unescape(encodeURIComponent(csv)));

      const sha = await fetch(`https://api.github.com/repos/${repoUser}/${repoName}/contents/${filePath}`)
        .then(res => res.json()).then(d => d.sha);

      await fetch(`https://api.github.com/repos/${repoUser}/${repoName}/contents/${filePath}`, {
        method: "PUT",
        headers: {
          "Authorization": `token ${githubToken}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: "تحديث تلقائي من صفحة الإدارة",
          content: contentBase64,
          sha: sha,
          branch: branch
        })
      });

      document.getElementById("lastUpdated").innerText = `📌 تم التحديث بتاريخ: ${new Date().toLocaleString('ar-EG')}`;
      alert("✅ تم حفظ البيانات ورفعها إلى GitHub بنجاح!");
    }
  </script></body>
  </html>
