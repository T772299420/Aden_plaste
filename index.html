<!DOCTYPE html>
<html lang="ar" dir="rtl">
  
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>شركة عدن الوطنية للصناعات المنزلية</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
  
  
  
  
  <style>
 #btnCloseGroups {
  position: absolute;
  top: 20%;
  right: 15px;
  transform: translateY(-100%);
  width: 64px;
  height: 64px;
  background: linear-gradient(135deg, #ff4e50, #8B0000);
  color: #8B0000;
  border: none;
  border-radius: 50%;
  display: none;
  align-items: center;
  justify-content: center;
  font-size: 280px;
  font-weight: bold;
  cursor: pointer;
  z-index: 2000;
  box-shadow: 0 100px 250px rgba(255, 78, 80, 0.6);
  transition: all 0.3s ease;
  user-select: none;
}

#btnCloseGroups:hover {
  background: linear-gradient(189deg, #8B0000, #8B0000);
  transform: translateY(-100%) scale(1.1);
  box-shadow: 0 14px 30px #8B0000(29, 21, 35, 0.8);
}

    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f9f9f9; margin: 0; padding: 0; color: #333; }
    h2 { color: #8B0000; margin-bottom: 20px; font-weight: 700; text-align: center; }
    
   

#pageFooter {
  position: fixed;
  bottom: 0;
  width: 100%;
  z-index: 1001;
}
    
    #tabBar {
      background: #8B0000; display: flex; align-items: center;
      padding: 10px 15px; gap: 15px; flex-wrap: wrap; position: sticky; top: 0; z-index: 1000;
    }
    .tab {
  font-size: 18px;
  cursor: pointer;
  padding: 10px 18px;
  border-radius: 8px;
  background-color: #8B0000;
  color: white;
  margin-left: 5px;
  display: inline-block;
  transition: background-color 0.3s;
}
.tab:hover {
  background-color: #a30000;
}

    #tabBar button.tabBtn {
      background: transparent; border: none; color: #fff;
      font-size: 18px; cursor: pointer; padding: 10px 18px; border-radius: 8px;
    }
    #tabBar button.tabBtn.active, #tabBar button.tabBtn:hover {
      background: #f44336;
    }
    .search-container {
      margin-left: auto; display: flex; align-items: center; gap: 10px;
    }
    #searchInput {
      padding: 7px 12px; font-size: 16px; border-radius: 8px; border: none; width: 200px;
    }
    #searchBtn, #btnClientInfo {
      padding: 9px 14px; border-radius: 8px; cursor: pointer;
      font-size: 16px; border: none; color: #fff;
    }
    #searchBtn { background: #f44336; }
    #btnClientInfo { background: #004d40; margin-left: 10px; }
    .tabContent {
      display: none; padding: 20px; max-width: 1100px; margin: auto; background: white;
    }
    .tabContent.active { display: block; }
    .group-section { margin-bottom: 20px; }
    .group-header {
      background: #8B0000;
      background: rgba(139, 0, 0, 0.1); /* خلفية حمراء شفافة بنسبة 10% */
      color: #8B0000; padding: 12px 18px; font-size: 1.2rem; font-weight: bold;
      border: 2px solid #8B0000;
      cursor: pointer; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;
    }
      .group-header {
  background: linear-gradient(190deg, rgba(190, 0, 0, 0.8), rgba(255, 255, 255, 0.1));
  color: white;
  padding: 12px 18px;
  font-size: 1.2rem;
  font-weight: bold;
  border: 2px solid #8B0000;
  font-size: 1.3rem; /* تم تكبير الخط */
  font-weight: bold;
  cursor: pointer;
  border-radius: 8px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  backdrop-filter: brightness(1.2);
  box-shadow: 0 0 10px #8B0000(1, 0, 0, 0.3);
}
    
    
    .group-items {
      display: grid; grid-template-columns: repeat(auto-fill,minmax(230px,1fr));
      gap: 20px; padding: 15px 10px;
    }
    .group-collapsed .group-items { display: none; }
    .group-arrow { font-size: 1.4rem; transition: transform 0.3s ease; }
    .group-collapsed .group-arrow { transform: rotate(90deg); }
    .item {
      border: 1px solid #ccc; padding: 10px; border-radius: 8px; background: #fefefe;
    }
    .item.highlighted { border-color: #f44336; background: #fff0f0; }
    .image-box img {
      width: 100%; height: 200px; object-fit: contain;
    }
    .item-details { display: flex; flex-direction: column; gap: 8px; }
    .item-controls { display: flex; align-items: center; gap: 10px; }
    .notes-btn {
      background-color: #2196f3;
      border: none; color: white;
      padding: 5px 10px; border-radius: 6px;
      cursor: pointer; font-size: 14px;
    }
    mark {
      background: yellow; color: black; padding: 0 4px;
    }
    #bottomBar {
      position: fixed; bottom: 0; width: 100%; background: #fff;
      border-top: 1px solid #ccc; display: flex; justify-content: center;
      gap: 10px; padding: 10px; z-index: 1000;
    }
    #bottomBar button {
      padding: 10px 16px; font-size: 16px;
      border: none; border-radius: 8px;
      cursor: pointer; color: white;
    }
    #btnNewOrder { background-color: #FF9800; }
    #showOrderBtn { background-color: #2196F3; }
    #whatsappBtn { background-color: #25d366; }
    #bottomBar {
  position: fixed;
  bottom: 40px; /* تم رفعه فوق الفوتر */
  right: 0;
  left: 0;
  background-color: #f9f9f9;
  padding: 8px;
  text-align: center;
  z-index: 999;
  border-top: 1px solid #ccc;
}

#footerInfo {
  position: fixed;
  bottom: 0;
  right: 0;
  left: 0;
  background-color: #8B0000;
  color: white;
  text-align: center;
  padding: 5px 10px;
  font-size: 14px;
  z-index: 998;
  white-space: nowrap;
  overflow-x: auto;
}

#footerInfo a {
  color: white;
  text-decoration: none;
  margin: 0 5px;
}
    .logo {
  height: 48px;                /* ارتفاع الشعار */
  border-radius: 10px;         /* زوايا مستديرة */
  box-shadow: 0 2px 5px rgba(0,0,0,0.3); /* ظل بسيط تحت الصورة */
  margin-inline-start: 10px;   /* مسافة من جهة اليسار في تخطيط RTL */
  background: white;           /* خلفية بيضاء حول الشعار */
  padding: 4px;      /* حشو داخلي */
}
<style>

  .search-container {
    display: flex;
    justify-content: center;
    margin: 10px 0;
  }
/*حجم عمود البحث */
  #searchInput {
    width: 200px;      /* عرض الحقل */
    height: 40px;      /* ارتفاع الحقل */
    font-size: 18px;   /* حجم الخط */
    padding: 8px 12px; /* مساحة داخلية */
    border: 2px solid #8B0000; /* إطار أنيق بلون أحمر غامق */
    border-radius: 10px;
    outline: none;
  }


  #searchInput::placeholder {
    color: #aaa;
    font-size: 16px;
  }
</style>
  </style>
</head>
<body>
  <div id="tabBar">
   <button class="tabBtn active" data-tab="sales" style="color: white; border: 2px solid white; border-radius: 8px;">
  <i class="fa fa-shopping-cart" aria-hidden="true" style="margin-left:8px;"></i> الطلبات
</button>
  <button class="tabBtn" data-tab="client" style="color: white; border: 2px solid white;">
  <i class="fas fa-user" style="margin-left: 5px;"></i>
  بيانات العميل
</button>
        <!-- تبويب تحميل الكتلوج -->
  <!-- زر تحميل الكتلوج مع أيقونة FontAwesome -->
<button class="tab" onclick="confirmDownload()" style="cursor: pointer; color: white; border: 2px solid white;">
  <i class="fas fa-download" style="margin-left: 5px;"></i> 
</button>

<script>
  function confirmDownload() {
    const confirmed = confirm("هل تريد تحميل كتلوج المنتجات؟");
    if (confirmed) {
      window.open("https://github.com/T772299420/Aden_plaste/raw/main/%D9%83%D8%AA%D9%84%D9%88%D8%AC%20%D8%A7%D9%84%D9%85%D9%86%D8%AA%D8%AC%D8%A7%D8%AA%20%D9%8A%D9%88%D9%86%D9%8A%D9%88%202025.pdf", "_blank");
    }
  }
</script>
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="ابحث عن صنف..." />
      <!-- أضف هذا الزر ضمن شريط التبويبات الرئيسي -->


<style>
  .tab {
    font-size: 18px;
    cursor: pointer;
    padding: 10px 18px;
    border-radius: 8px;
    background-color: #8B0000;
    color: white;
    margin-left: 5px;
    display: inline-block;
    transition: background-color 0.3s;
  }
  .tab:hover {
    background-color: #a30000;
  }
</style>
     
      <img class="logo" src="https://raw.githubusercontent.com/T772299420/Aden_plaste/main/logo.png" alt="Logo" />
    </div>
  </div>

<div id="sales" class="tabContent active">
  <div class="section-header">
    <h2>🛒 قسم الطلبات</h2>
    <p>يرجى اختيار الكمية المطلوبة لكل صنف ثم الضغط على زر إرسال الطلب.</p>
  </div>
  <div id="salesItems" class="items-container"></div>
</div>

  <div id="client" class="tabContent">
    <h2>بيانات العميل</h2>
    <div>
      <label>الاسم الرباعي:</label><input type="text" id="clientFullName" /><br><br>
      <label>الاسم التجاري:</label><input type="text" id="clientTradeName" /><br><br>
      <label>عنوان المحل:</label><input type="text" id="clientAddress" /><br><br>
      <label>رقم الهاتف:</label><input type="text" id="clientPhone" dir="ltr" /><br><br>
      <button id="saveClientInfoBtn" class="btn-yes">💾 حفظ البيانات</button>
    </div>
  </div>

<div id="bottomBar">
  <!-- زر إغلاق المجموعات -->
<button id="btnCloseGroups" style="background-color: red; color: white; border-radius: 50%; padding: 10px; font-size: 20px; display: none;">
  ×
</button>
  <button id="btnNewOrder">🗑️ طلب جديد</button>
  
  <button id="showOrderBtn" style="display:none;">📄 عرض الطلب</button>
  <button id="whatsappBtn" style="display:none;">📤 إرسال الطلب</button>
</div>

<!-- بيانات التواصل أسفل الأزرار -->
<div id="footerInfo">
  المميز سوفت للأنظمة المحاسبية المتكاملة   
  <a href="https://wa.me/967772299420" target="_blank">📞 +967 772299420</a> 
  <a h
</div>

  
  <script>
function downloadCatalog() {
  const url = 'https://github.com/T772299420/Aden_plaste/raw/main/%D9%83%D8%AA%D9%84%D9%88%D8%AC%20%D8%A7%D9%84%D9%85%D9%86%D8%AA%D8%AC%D8%A7%D8%AA%20%D9%8A%D9%88%D9%86%D9%8A%D9%88%202025.pdf';
  const link = document.createElement('a');
  link.href = url;
  link.download = 'كتالوج المنتجات.pdf'; // اسم الملف عند التنزيل
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}


  let itemsData = [];
let savedQuantities = JSON.parse(localStorage.getItem('selectedQuantities') || '{}');
let savedItemNotes = JSON.parse(localStorage.getItem('itemNotes') || '{}');
let clientInfo = JSON.parse(localStorage.getItem('clientInfo') || '{}');
let groupStates = {};
let lastOpenedGroup = '';

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('btnCloseGroups').onclick = () => {
  // غلق كل المجموعات
  groupStates = {};
  lastOpenedGroup = '';

  // إخفاء زر الإغلاق
  document.getElementById('btnCloseGroups').style.display = 'none';

  // إعادة تصنيف كل الأقسام كمغلقة
  document.querySelectorAll('.group-section').forEach(section => {
    section.classList.add('group-collapsed');
  });
};
  fetch('https://raw.githubusercontent.com/T772299420/Aden_plaste/main/data%20(7).csv')
    .then(res => res.text())
    .then(text => {
      const rows = text.trim().split('\n').map(row => row.split(','));
      const headers = rows.shift();
      itemsData = rows.map(row => {
  const obj = {};
  headers.forEach((h, i) => obj[h.trim().toLowerCase()] = row[i]?.trim() || '');
  obj._priority = parseFloat(row[5]) || 0; // العمود F هو السادس (index 5)
  return obj;
});

// ترتيب تصاعدي حسب العمود السادس (الذي أضفناه باسم _priority)
itemsData.sort((a, b) => a._priority - b._priority);
      // التحقق من وجود بيانات العميل
      fillClientInputs();
      if (!clientInfo.fullName || !clientInfo.phone) {
        alert("يرجى إدخال بيانات العميل أولاً.");
        switchToTab("client");
      }
      
      if (Object.keys(savedQuantities).length > 0) {
        if (confirm("يوجد طلب محفوظ مسبقًا، هل ترغب بإنشاء طلب جديد؟")) {
          clearOrder();
        }
      }
      
      renderSalesItems();
      updateButtonsVisibility();
    });
  
  document.getElementById('searchInput').addEventListener('input', (e) => {
    const keyword = e.target.value.trim().toLowerCase();
    renderSalesItems(keyword);
  });
  
  document.getElementById('saveClientInfoBtn').onclick = () => {
    clientInfo = {
      fullName: document.getElementById('clientFullName').value.trim(),
      tradeName: document.getElementById('clientTradeName').value.trim(),
      address: document.getElementById('clientAddress').value.trim(),
      phone: document.getElementById('clientPhone').value.trim(),
    };
    localStorage.setItem('clientInfo', JSON.stringify(clientInfo));
    alert("تم حفظ بيانات العميل");
  };
  
  document.querySelectorAll('.tabBtn').forEach(btn => {
    btn.addEventListener('click', () => {
      const targetTab = btn.dataset.tab;
      if (targetTab === 'sales' && (!clientInfo.fullName || !clientInfo.phone)) {
        alert("لا يمكنك الدخول إلى الطلبات قبل إدخال بيانات العميل.");
        switchToTab("client");
        return;
      }
      switchToTab(targetTab);
    });
  });
  
  document.getElementById('btnNewOrder').onclick = () => {
    if (confirm("هل أنت متأكد من بدء طلب جديد؟")) {
      clearOrder();
      renderSalesItems();
      updateButtonsVisibility();
    }
  };
  
document.getElementById('showOrderBtn').onclick = () => {
  const items = Object.keys(savedQuantities);
  if (!items.length) return alert("لا توجد أصناف مختارة.");

  if (messagePages && messagePages.length > 0) {
    const currentMsg = messagePages[currentPage] || '';
    return alert(`الطلب الحالي - صفحة ${currentPage + 1}:\n\n${currentMsg}`);
  }

  // في حال لم يتم التقسيم، نعرض جميع الطلبات يدويًا
  let msg = "الطلب الحالي:\n\n";
  items.forEach(name => {
    msg += `- ${name}: ${savedQuantities[name]}`;
    if (savedItemNotes[name]) msg += ` (ملاحظة: ${savedItemNotes[name]})`;
    msg += '\n';
  });

  alert(msg);
};

  const MAX_WHATSAPP_LENGTH = 3900; // أقل من الحد الرسمي

let currentPage = 0;
let messagePages = [];

function paginateMessage(message) {
  const pages = [];
  let start = 0;
  while (start < message.length) {
    pages.push(message.substring(start, start + MAX_WHATSAPP_LENGTH));
    start += MAX_WHATSAPP_LENGTH;
  }
  return pages;
}

function renderPaginationControls() {
  let container = document.getElementById('paginationControls');
  if (!container) {
    container = document.createElement('div');
    container.id = 'paginationControls';
    container.style.textAlign = 'center';
    container.style.marginTop = '10px';
    document.getElementById('bottomBar').appendChild(container);
  }
  container.innerHTML = '';

  if (messagePages.length <= 1) return;

  for (let i = 0; i < messagePages.length; i++) {
    const btn = document.createElement('button');
    btn.textContent = `صفحة ${i + 1}`;
    btn.style.margin = '0 5px';
    btn.style.padding = '6px 12px';
    btn.style.borderRadius = '6px';
    btn.style.border = '1px solid #8B0000';
    btn.style.background = (i === currentPage) ? '#8B0000' : 'white';
    btn.style.color = (i === currentPage) ? 'white' : '#8B0000';
    btn.style.cursor = 'pointer';
    btn.onclick = () => {
      currentPage = i;
      renderPaginationControls();
    };
    container.appendChild(btn);
  }
}

document.getElementById('whatsappBtn').onclick = () => {
  if (!Object.keys(savedQuantities).length) return alert("لا توجد أصناف.");
  if (!clientInfo.phone) return alert("يرجى إدخال رقم الهاتف أولًا.");
  const date = new Date().toISOString().split('T')[0];
  let msg = `أنا العميل / ${clientInfo.fullName || ''} - ${clientInfo.tradeName || ''}\n`;
  msg += `عنواني / ${clientInfo.address || ''}\nرقم هاتفي / ${clientInfo.phone || ''}\nتاريخ الطلب / ${date}\n`;
  msg += `__________________________\nالاصناف المطلوبة:\n`;
  Object.keys(savedQuantities).forEach(name => {
    const item = itemsData.find(i => i.name === name);
    const unit = item?.unit || 'وحدة';
    const qty = savedQuantities[name];
    const note = savedItemNotes[name] ? ` - ملاحظة: ${savedItemNotes[name]}` : '';
    msg += `- ${name} - ${unit} - ${qty}${note}\n`;
  });

  // تقسيم الرسالة إلى صفحات
  messagePages = paginateMessage(msg);

  if (currentPage >= messagePages.length) currentPage = 0;

  // أظهر أزرار الصفحات
  renderPaginationControls();

  // إرسال الصفحة الحالية فقط
  const encodedMsg = encodeURIComponent(messagePages[currentPage]);
  const url = `https://wa.me/967771334747?text=${encodedMsg}`;
  window.open(url, '_blank');
};

});

function switchToTab(tabName) {
  document.querySelectorAll('.tabBtn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tabContent').forEach(tab => tab.classList.remove('active'));
  document.querySelector(`.tabBtn[data-tab="${tabName}"]`).classList.add('active');
  document.getElementById(tabName).classList.add('active');
}

function renderSalesItems(keyword = '') {
  const container = document.getElementById('salesItems');
  container.innerHTML = '';
  const groups = {};
  
  itemsData.forEach(item => {
    const group = item.group || 'أخرى';
    if (!groups[group]) groups[group] = [];
    groups[group].push(item);
  });
  
  Object.entries(groups).forEach(([group, items]) => {
    const matchedItems = keyword ?
      items.filter(i => i.name.toLowerCase().includes(keyword)) :
      items;
    
    if (keyword && matchedItems.length === 0) return;
    
    const section = document.createElement('div');
    section.className = 'group-section';
    
    const selectedCount = items.filter(i => savedQuantities[i.name]).length;
    const header = document.createElement('div');
    header.className = 'group-header';
    header.innerHTML = `<span>${group} - العدد ${items.length}</span>
<span class="group-arrow"><i class="fas fa-angle-double-down" style="color: #8B0000;"></i></span>`;

    header.onclick = () => {
  const collapsed = section.classList.toggle('group-collapsed');
  groupStates[group] = !collapsed;
  if (!collapsed) lastOpenedGroup = group;
  
  // بعد التبديل، نتحقق هل هناك أي مجموعة مفتوحة لنظهر زر الإغلاق
  const anyGroupOpen = Object.values(groupStates).some(state => state === true);
  document.getElementById('btnCloseGroups').style.display = anyGroupOpen ? 'inline-block' : 'none';
};

    const itemsContainer = document.createElement('div');
    itemsContainer.className = 'group-items';
    
    matchedItems.forEach(item => {
      const name = item.name;
      const unit = item.unit || 'وحدة';
      const image = item.image || '';
      const imgUrl = `https://raw.githubusercontent.com/T772299420/Aden_plaste/main/${image}`;
      const qty = savedQuantities[name] || '';
      const note = savedItemNotes[name] || '';
      
      const card = document.createElement('div');
      card.className = `item ${qty ? 'highlighted' : ''}`;
      card.innerHTML = `
        <div class="image-box"><img src="${imgUrl}" alt="${name}" /></div>
        <div class="item-details">
        <p>${highlightKeyword(name, keyword)} (${unit}) ${qty ? '👍' : ''}</p>
          <div class="item-controls">
            <label>الكمية:
              <input type="number" dir="ltr" min="0" value="${qty}" data-name="${name}" oninput="onQuantityChange(this)" />
            </label>
            <button class="notes-btn" onclick="addNote('${name}')">ملاحظات${note ? ' ✓' : ''}</button>
          </div>
        </div>`;
      itemsContainer.appendChild(card);
    });
    
    section.appendChild(header);
    section.appendChild(itemsContainer);
    
    const shouldOpen = keyword ?
      true :
      (group === lastOpenedGroup || groupStates[group]);
    
    if (!shouldOpen) section.classList.add('group-collapsed');
    container.appendChild(section);
  });
}

function onQuantityChange(input) {
  const qty = parseInt(input.value) || 0;
  const name = input.dataset.name;
  const card = input.closest('.item');
  
  if (qty > 0) {
    savedQuantities[name] = qty;
    card.classList.add('highlighted');
  } else {
    delete savedQuantities[name];
    delete savedItemNotes[name];
    card.classList.remove('highlighted');
  }
  
  const titleElement = input.closest('.item-details').querySelector('p');
  if (titleElement) {
    const unit = itemsData.find(i => i.name === name)?.unit || 'وحدة';
    const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
    titleElement.innerHTML = `${highlightKeyword(name, keyword)} (${unit}) ${qty ? '👍' : ''}`;
  }
  
  localStorage.setItem('selectedQuantities', JSON.stringify(savedQuantities));
  localStorage.setItem('itemNotes', JSON.stringify(savedItemNotes));
  updateButtonsVisibility();
}

function addNote(name) {
  const note = prompt("أدخل الملاحظة:", savedItemNotes[name] || '');
  if (note !== null) {
    if (note.trim()) savedItemNotes[name] = note.trim();
    else delete savedItemNotes[name];
    localStorage.setItem('itemNotes', JSON.stringify(savedItemNotes));
    renderSalesItems(document.getElementById('searchInput').value.trim().toLowerCase());
  }
}

function highlightKeyword(text, keyword) {
  if (!keyword) return text;
  return text.replace(new RegExp(`(${keyword})`, 'gi'), `<mark>$1</mark>`);
}

function fillClientInputs() {
  document.getElementById('clientFullName').value = clientInfo.fullName || '';
  document.getElementById('clientTradeName').value = clientInfo.tradeName || '';
  document.getElementById('clientAddress').value = clientInfo.address || '';
  document.getElementById('clientPhone').value = clientInfo.phone || '';
}

function clearOrder() {
  savedQuantities = {};
  savedItemNotes = {};
  localStorage.removeItem('selectedQuantities');
  localStorage.removeItem('itemNotes');
  updateButtonsVisibility();
// حذف أزرار الصفحات عند طلب جديد
  const paginationContainer = document.getElementById('paginationControls');
  if (paginationContainer) {
    paginationContainer.innerHTML = '';
  }
  currentPage = 0; // إعادة تعيين الصفحة الحالية
}


function updateButtonsVisibility() {
  const visible = Object.keys(savedQuantities).length > 0;
  document.getElementById('showOrderBtn').style.display = visible ? 'inline-block' : 'none';
  document.getElementById('whatsappBtn').style.display = visible ? 'inline-block' : 'none';
}
</script> 
</body>
</html>
    
